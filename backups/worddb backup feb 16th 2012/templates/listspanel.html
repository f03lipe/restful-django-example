<!DOCTYPE html>

<html>
<head>

	<meta http-equiv="content-type" content="text/ html;charset=utf-8" />
	<title>Panel of Lists</title>

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.js" type="text/javascript"></script>

	<script src="/static/js/bootstrap.js" type="text/javascript"></script>
	<script src="/static/js/jquery-autoresize.js" type="text/javascript"></script>
	<script src="/static/js/function.js" type="text/javascript"></script>

<style type="text/css">

@import url(/static/cssreset.css);
@import url(/static/bootstrap.css);
@import url(/static/buttons.css);
@import url(/static/global.css);

</style>
</head>

<!-- BODY -->

<body>

	<h2>Lists Panel</h2>
	
	<div>
		<!-- ORDERBY -->
		<div class="orderby-box">
			<div><b>order by:</b>
			<select onCshange="location.replace('?order_by='+$(this).val())">
				<option value="created">created (oldest to newest)</option>
				<option value="-created">created (newest to oldest)</option>
				<option value="modified">modified (oldest to newest)</option>
				<option value="-modified">modified (newest to oldest)</option>
				<option value="listlabel">list label</option>
				<option value="-listlabel">list label - inversed</option>
			
				<script>
				var options = document.querySelectorAll('.orderby-box select option');
				for (var i=0; i < options.length; i++)
					if (options[i].value === '{{ order_by }}') {
						options[i].selected = true;
						break;
					}
				</script>
			</select>
			</div>
			<button class="styled-button red small" onClick="location.replace('?order_by='+$('.orderby-box select').val())">Order</button>
		</div>
		<!-- /ORDERBY -->
		<button class="styled-button blue" onClick="make_add_list_box()">Add List</button>
	</div>
	


	<ul id="lists-wrapper" class="tags-wrapper">
	{% for list in lists %}
		<li class="list" data-label="{{ list.label }}" data-description="{{ list.description }}" data-listid="{{ list.id }}">
			<a href="/lists/{{ list.label }}" class="tag primary-tag">
				<span class="list-label">{{ list.label }}</span>
			</a>
			<button class="tag auxiliar-tag" onClick="make_edit_list_box($(this).parent('li'));">edit</button>
		</li>
	{% empty %}
	<script>
		show_no_tags_message("» no lists found");
	</script>
	{% endfor %}
	</ul>


	<footer>
		<a href="/account">account panel</a> | 
		<a href="/about">about this app</a> | 
		<a href="/logout">logout</a>
	</footer>

	<div id="blackout" style="display: none"></div>

<!-- ####SCRIPT#### -->
<script type="text/javascript">

// $('.tag, .button, .styled-button').addClass('unselectable'); // do it in the html

_csrf_token = '{{csrf_token}}';

{% for msg in flash_messages %}
	show_flash_message('{{ msg }}', {'border': '1px solid #0FB05E'}, 8000+{{ forloop.counter }}*1000);
{% endfor %}

{% for error in flash_errors %}
	show_flash_message('{{ error }}', {'background': '#FB3F51'}, 8000+{{ forloop.counter }}*1000);
{% endfor %}


$.ctrl('S', function() {
    alert("Saved");
});

// 


function add_list_tag(form) {
	$("ul.tags-wrapper #no-tags-message").remove();
	$.tmpl('<li class="list" data-label="${label}" data-description="${description}" data-listid="${listid}">\
			<a href="/lists/${label}" class="tag primary-tag">\
				<span class="list-label">${label}</span>\
			</a>\
			<button class="tag auxiliar-tag" onClick="make_edit_list_box($(this).parent(\'li\'));">edit</button>\
		</li>', form).hide().appendTo('ul#lists-wrapper').fadeIn();
}

function adsd_list_tag(form) { // ads a list tag to the lists wrapper
	$("ul.tags-wrapper #no-tags-message").remove();
	$.tmpl('<li class="list" data-label="${label}" data-description="${description}" data-listid="${listid}">\
			<a href="/lists/${label}" class="tag primary-tag">\
				<span class="list-label">${label}</span>\
					<input type="hidden" name="label" value="${label}">\
					<input type="hidden" name="description" value="${description}">\
					<input type="hidden" name="listid" value="${listid}">\
			</a>\
			<button class="tag auxiliar-tag" onClick="make_edit_list_box($(this).parent(\'li\'));">edit</button>\
		</li>', form).hide().appendTo('ul#lists-wrapper').fadeIn();
}

function update_list_tag(form) {
	$(['label', 'description']).each(function (index, item) {
		document.body.querySelector("li.list[data-listid='"+form['listid']+"']").dataset[item] = form[item];
	});
}

function upsdate_list_tag(form) { // updates the original list tag in the lists panel with new edited content
	var p = $("li.list input[name=listid][value="+form['listid']+"]").parent();
	p.find('.list-label').html(form['label']);
	$(['label', 'description']).each(function (index, item) {
		p.find("input[name="+item+"]").val(form[item]);
	});
}

function remove_list_tag(form) {
	var tag = document.body.querySelector("li.list[data-listid='"+form[listid]+"'");
	tag.fadeOut(function () {
		$(this).remove();
		if (!document.body.querySelector("ul.tags-wrapper li")) // add 'no tags' message?
			show_no_tags_message("» no lists found");
	})
}

function remsove_list_tag(form) { // removes the original word tag from the list page
	var o = $("li.list input[name=listid][value="+form['listid']+"]");
	o.parent().parent().fadeOut( function() {
		$(this).remove();
		
		if (!$("ul.tags-wrapper li")[0]) // add 'no tags' message?
			show_no_tags_message("» no lists found");
	});
}

// HTML for Edit/Add-List boxes
var edit_list_box_html = '<div id="edit-wrapper" class="styled-box">\
		<div title="close" class="close-button" onClick="remove_edit_list_box()"></div>\
	    <h2 class="box-title">Edit a List:</h2>\
		<div class="edit-field" data-field="label">\
			<div class="edit-field-label">list name:</div>\
			<textarea class="edit-field-value">${label}</textarea>\
		</div>\
		<div class="edit-field" data-field="description">\
			<div class="edit-field-label">description:</div>\
			<textarea class="edit-field-value">${description}</textarea>\
		</div>\
		<input type="hidden" name="listid" value="" />\
		<div class="buttons">\
		<button class="edit-button button blue unselectable" id="save-button" onClick="update_list_db(_csrf_token)">Save</button>\
		<button class="edit-button button red unselectable" id="remove-button" onClick="remove_list_db(_csrf_token)">Remove</button>\
		</div>\
	</div>';

var add_list_box_html = '<div id="edit-wrapper" class="styled-box">\
		<div title="close" class="close-button" onClick="remove_add_list_box()"></div>\
		<div class="box-title">Add a List:</div>\
		<div class="edit-field" data-field="label">\
			<div class="edit-field-label">list name:</div>\
			<textarea class="edit-field-value"></textarea>\
		</div>\
		<div class="edit-field" data-field="description">\
			<div class="edit-field-label">description:</div>\
			<textarea class="edit-field-value"></textarea>\
		</div>\
		<div class="buttons">\
		<button class="edit-button button blue unselectable" id="add-button" onClick="add_list_db(_csrf_token)">Create List</button>\
		<button class="edit-button button red unselectable" id="cancel-button" onClick="remove_add_word_box()">Cancel</button>\
		</div>\
	</div>';

</script>

</body>
</html>