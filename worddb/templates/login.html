<!DOCTYPE html>

<html>
<head>

	<meta http-equiv="content-type" content="text/ html;charset=utf-8" />
	<title>Login</title>

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

	<script src="/static/js/bootstrap.js" type="text/javascript"></script>
	<script src="/static/js/jquery-autoresize.js" type="text/javascript"></script>
	<script src="/static/js/function.js" type="text/javascript"></script>

<style type="text/css">

@import url(/static/cssreset.css);
@import url(/static/bootstrap.css);
@import url(/static/buttons.css);
@import url(/static/global.css);

</style>
</head>
<body>

<div stysle="text-align: center">
	<div class="styled-box login-box">
	<form method="post" action="javascript:login()">
		{% csrf_token %}
		<h2 class="box-title">Log in</h2>

		<div class="edit-field">
			<div class="edit-field-label">email</div>
			<input class="edit-field-value" name="email" type="email" />
		</div>

		<div class="edit-field">
			<div class="edit-field-label">password</div>
			<input class="edit-field-value" type="password" maxlength=50 name="password" />
		</div>

		<div class="buttons">
		<button class="button blue" type="submit">Go!</button>
		<input type="button" onClick="location.replace('/signin')" class="button green" value="Sign In" />
		</div>
	</form>
	</div>
</div>

<script type="text/javascript">

$(".edit-field-value[name=email]").focus();


{% for msg in flash_messages %}
	show_flash_message('{{ msg }}', {}, 8000+{{ forloop.counter }}*1000);
{% endfor %}

{% for error in flash_errors %}
	show_flash_message('{{ error }}', {'background': '#FB3F51'}, 8000+{{ forloop.counter }}*1000);
{% endfor %}

//

function login() {

	var form = {};
	form['email'] = $(".login-box input[name=email]").val();
	form['password'] = $(".login-box input[name=password]").val();
	form['csrfmiddlewaretoken'] = $(".login-box input[name=csrfmiddlewaretoken]").val();

	$.ajax({
		url: '/login/',
		context: this, 
		data: form, 
		dataType: 'json',
		type: 'post',
		success: function (data, status) {
			console.log('data received', data);
			if (data['success']) {
				show_flash_message('you\'re being logged in <img src="/static/images/loading.gif" />');
				setTimeout(function () { location.replace(data['redirect']); }, 2000);
			} else 
				for (var i=0; i<data['errors'].length; i++)
					show_flash_message(data['errors'][i], {'background': "#F60018"});				
		}, 
		errors: function (obj, status) {
			alert(12); // wtf??
		} });
}


</script>
</body>
</html>
















