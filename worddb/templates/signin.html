<!DOCTYPE html>

<html>
<head>

<title>signin</title>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" type="text/javascript"></script>
<script src="/static/js/jquery-autoresize.js" type="text/javascript"></script>
<script src="/static/function.js" type="text/javascript"></script>

<style type="text/css">

@import url(/static/buttons.css);
@import url(/static/global.css);

</style>
</head>
<body>

<div class="styled-box login-box">
<form method="post" action="javascript:signin()">
	{% csrf_token %}
	<h2 class="box-title">Sign In</h2>

	<div class="edit-field">
		<div class="edit-field-label">first name
			<div style="color: #888; font-size: 13px; float: right">what should we call you?</div>
		</div>
		<input class="edit-field-value" name="first_name" type="text" />
	</div>

	<div class="edit-field">
		<div class="edit-field-label">email
			<div style="color: #888; font-size: 13px; float: right">used to login</div>
		</div>
		<input class="edit-field-value" name="email" type="esmail" />
	</div>

	<div class="edit-field">
		<div class="edit-field-label">password
			<div style="color: #888; font-size: 13px; float: right">at least 6 characters</div>
		</div>
		<input class="edit-field-value" autocomplete="off" type="password" maxlength=50 name="password" />
	</div>

	<div class="buttons">
		<button class="button blue" type="submit">Register</button>
		<input type="button" onClick="location.replace('/login')" value="Back to Login" class="button red" />
	</div>
</form>
</div>

<script type="text/javascript">

$(".edit-field-value[name=first_name]").focus();

{% for msg in flash_messages %}
	show_flash_message('{{ msg }}', {}, 8000+{{ forloop.counter }}*1000);
{% endfor %}

{% for error in flash_errors %}
	show_flash_message('{{ error }}', {'background': '#FB3F51'}, 8000+{{ forloop.counter }}*1000);
{% endfor %}

//

function signin() {

	var form = {};
	form['first_name'] = $(".login-box input[name=first_name]").val();
	form['email'] = $(".login-box input[name=email]").val();
	form['password'] = $(".login-box input[name=password]").val();
	form['csrfmiddlewaretoken'] = $(".login-box input[name=csrfmiddlewaretoken]").val();

	$.ajax({
		url: '/signin/',
		context: this, 
		data: form, 
		dataType: 'json',
		type: 'post',
		success: function (data, status) {
			console.log('data received', data);
			if (data['success']) {
				show_flash_message(data['text']);
				setTimeout(function () { location.replace(data['redirect']); }, 2000);
			} else 
				for (var i=0; i<data['errors'].length; i++)
					show_flash_message(data['errors'][i], {'background': "#F60018"});				
		}, 
		error: function (obj, status) {
			alert(12); // wtf??
		} });
}

</script>
</body>
</html>